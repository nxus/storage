<!doctype html>
<html>
<head>
  <meta charset='utf-8' />
  <title>nxus-storage 4.0.0 | Documentation</title>
  <meta name='viewport' content='width=device-width,initial-scale=1'>
  <link href='assets/bass.css' type='text/css' rel='stylesheet' />
  <link href='assets/style.css' type='text/css' rel='stylesheet' />
  <link href='assets/github.css' type='text/css' rel='stylesheet' />
</head>
<body class='documentation'>
  <div class='max-width-4 mx-auto'>
    <div class='clearfix md-mxn2'>
      <div class='fixed xs-hide fix-3 overflow-auto max-height-100'>
        <div class='py1 px2'>
          <h3 class='mb0 no-anchor'>nxus-storage</h3>
          <div class='mb1'><code>4.0.0</code></div>
          <input
            placeholder='Filter'
            id='filter-input'
            class='col12 block input'
            type='text' />
          <div id='toc'>
            <ul class='list-reset h5 py1-ul'>
              
                
                <li><a
                  href='#storage-module'
                  class="h5 bold black caps">
                  Storage Module
                  
                </a>
                
                </li>
              
                
                <li><a
                  href='#api'
                  class="h5 bold black caps">
                  API
                  
                </a>
                
                </li>
              
                
                <li><a
                  href='#storage'
                  class=" toggle-sibling">
                  Storage
                  <span class='icon'>▸</span>
                </a>
                
                <div class='toggle-target display-none'>
                  
                  
                    <ul class='list-reset py1-ul pl1'>
                      <li class='h5'><span>Instance members</span></li>
                      
                      <li><a
                        href='#Storage#model'
                        class='regular pre-open'>
                        #model
                      </a></li>
                      
                      <li><a
                        href='#Storage#getModel'
                        class='regular pre-open'>
                        #getModel
                      </a></li>
                      
                      <li><a
                        href='#Storage#modelDir'
                        class='regular pre-open'>
                        #modelDir
                      </a></li>
                      
                    </ul>
                  
                  
                  
                </div>
                
                </li>
              
                
                <li><a
                  href='#hasmodels'
                  class=" toggle-sibling">
                  HasModels
                  <span class='icon'>▸</span>
                </a>
                
                <div class='toggle-target display-none'>
                  
                  
                    <ul class='list-reset py1-ul pl1'>
                      <li class='h5'><span>Instance members</span></li>
                      
                      <li><a
                        href='#HasModels#models'
                        class='regular pre-open'>
                        #models
                      </a></li>
                      
                      <li><a
                        href='#HasModels#modelNames'
                        class='regular pre-open'>
                        #modelNames
                      </a></li>
                      
                    </ul>
                  
                  
                  
                </div>
                
                </li>
              
                
                <li><a
                  href='#basemodel'
                  class=" toggle-sibling">
                  BaseModel
                  <span class='icon'>▸</span>
                </a>
                
                <div class='toggle-target display-none'>
                  
                  <ul class='list-reset py1-ul pl1'>
                    <li class='h5'><span>Static members</span></li>
                    
                      <li><a
                        href='#BaseModel.connection'
                        class='regular pre-open'>
                        .connection
                      </a></li>
                    
                      <li><a
                        href='#BaseModel.findOrCreate'
                        class='regular pre-open'>
                        .findOrCreate
                      </a></li>
                    
                      <li><a
                        href='#BaseModel.createOrUpdate'
                        class='regular pre-open'>
                        .createOrUpdate
                      </a></li>
                    
                      <li><a
                        href='#BaseModel.extend'
                        class='regular pre-open'>
                        .extend
                      </a></li>
                    
                    </ul>
                  
                  
                    <ul class='list-reset py1-ul pl1'>
                      <li class='h5'><span>Instance members</span></li>
                      
                      <li><a
                        href='#BaseModel#displayName'
                        class='regular pre-open'>
                        #displayName
                      </a></li>
                      
                    </ul>
                  
                  
                  
                </div>
                
                </li>
              
                
                <li><a
                  href='#geomodel'
                  class=" toggle-sibling">
                  GeoModel
                  <span class='icon'>▸</span>
                </a>
                
                <div class='toggle-target display-none'>
                  
                  <ul class='list-reset py1-ul pl1'>
                    <li class='h5'><span>Static members</span></li>
                    
                      <li><a
                        href='#GeoModel.createGeoIndex'
                        class='regular pre-open'>
                        .createGeoIndex
                      </a></li>
                    
                      <li><a
                        href='#GeoModel.findWithin'
                        class='regular pre-open'>
                        .findWithin
                      </a></li>
                    
                      <li><a
                        href='#GeoModel.findIntersects'
                        class='regular pre-open'>
                        .findIntersects
                      </a></li>
                    
                      <li><a
                        href='#GeoModel.getGeometry'
                        class='regular pre-open'>
                        .getGeometry
                      </a></li>
                    
                      <li><a
                        href='#GeoModel.getCentroid'
                        class='regular pre-open'>
                        .getCentroid
                      </a></li>
                    
                    </ul>
                  
                  
                  
                  
                </div>
                
                </li>
              
                
                <li><a
                  href='#pointmodel'
                  class="">
                  PointModel
                  
                </a>
                
                </li>
              
            </ul>
          </div>
          <div class='mt1 h6 quiet'>
            <a href='http://documentation.js.org/reading-documentation.html'>Need help reading this?</a>
          </div>
        </div>
      </div>
      <div class='fix-margin-3'>
        
          
            <div class='keyline-top-not py2'><section class='py2 clearfix'>

  <h2 id='storage-module' class='mt0'>
    Storage Module
  </h2>

  
    <style>#toc .h5 { color: #1184CE; font-weight: normal; text-transform: none; letter-spacing: 0; }</style>
<p><a href="https://travis-ci.org/nxus/storage"><img src="https://travis-ci.org/nxus/storage.svg?branch=master" alt="Build Status"></a></p>
<p>A storage framework for Nxus applications using <a href="https://github.com/balderdashy/waterline">waterline</a>.</p>
<h3><a name="configuration"></a>Configuration</h3>
<pre><code>"config": {
  "storage": {
    "adapters": {
      "default": "sails-mongo"
    },
    "connections": {
      "default": {
        "adapter": "default",
        "url": "mongodb://...."
      }
    },
  }
}
</code></pre>
<h3>Defining models</h3>
<p>You define models by extending a base model class: <a href="#basemodel">BaseModel</a>
is a general-purpose base class; <a href="#geomodel">GeoModel</a> is a base class for
models containing a GeoJSON attribute. You can also define your own
base class by extending <a href="#basemodel">BaseModel</a> or <a href="#geomodel">GeoModel</a>.</p>
<p>(The <a href="#pointmodel">PointModel</a> base class, for models containing a GeoJSON
coordinate point attribute, is deprecated; use <a href="#geomodel">GeoModel</a>
instead.)</p>
<h3>Using models</h3>
<p><a href="#hasmodels">HasModels</a> is a base class for nxus modules that define or use
models. It automatically registers all model definitions contained in
the module <code>./models</code> subdirectory. It makes model definitions
available through its <a href="#hasmodelsmodels">HasModels#models</a> property, which you
can configure to load models defined by your module or other modules.</p>
<p>The <a href="#storage">Storage</a> <a href="#Storage#model">model()</a> and
<a href="#Storage#modelDir">modelDir()</a> methods let you explicitly
register model definitions, and you can use
<a href="#Storage#getModel">getModel()</a> to load definitions. However,
these methods are rarely used, since using the <a href="#hasmodels">HasModels</a> base
class is typically more concise and convenient.</p>
<h3>Model events</h3>
<p>The storage model emits events for create, update, and destroy.
You can register a handler for all events:</p>
<pre><code>  storage.on('model.create', (identity, record) => {})
  storage.on('model.update', (identity, record) => {})
  storage.on('model.destroy', (identity, record) => {})
</code></pre>
<p>Or just a specific model identity:</p>
<pre><code>  storage.on('model.create.user', (identity, record) => {})
  storage.on('model.update.user', (identity, record) => {})
  storage.on('model.destroy.user', (identity, record) => {})
</code></pre>
<h3>Lifecycle notes</h3>
<ul>
<li>
<p><code>load</code></p>
<ul>
<li>Models should be registered during <code>load</code>, e.g.
var User = BaseModel.extend({
identity: 'user',
...
});
application.get('storage').model(User)</li>
</ul>
</li>
<li>
<p><code>startup</code></p>
<ul>
<li>
<p>The configured database is connected during <code>load.after</code></p>
</li>
<li>
<p>You can query models from <code>startup</code> and beyond, retrieve the model by the 'identity':</p>
<pre><code>application.get('storage').getModel('user').then((User) => {
    User.create(...);
});
</code></pre>
</li>
</ul>
</li>
</ul>

  
</section>
</div>
          
        
          
            <div class='keyline-top-not py2'><section class='py2 clearfix'>

  <h2 id='api' class='mt0'>
    API
  </h2>

  
    

  
</section>
</div>
          
        
          
            <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    <h3 class='fl m0' id='storage'>
      Storage
    </h3>
    
    
      <a class='fr fill-darken0 round round pad1x quiet h5' href='https://github.com/nxus/storage/blob/8ebea370577a8e35ea8a8321d516d1ba6594eae1/src/index.js#L25-L182'>
      <span>src/index.js</span>
      </a>
    
  </div>
  

  <p>Storage provides a common interface for defining models.  Uses the Waterline ORM.</p>


  <div class='pre p1 fill-light mt0'>new Storage()</div>
  
  
    <p>
      Extends
      
        NxusModule
      
    </p>
  

  
  
  
  
  
  

  

  

  

  

  

  

  
    <div class='py1 quiet mt1 prose-big'>Instance Members</div>
    <div class="clearfix">
  
    <div class='border-bottom' id='Storage#model'>
      <div class="clearfix small pointer toggle-sibling">
        <div class="py1 contain">
            <a class='icon pin-right py1 dark-link caret-right'>▸</a>
            <span class='code strong strong truncate'>model(model)</span>
        </div>
      </div>
      <div class="clearfix display-none toggle-target">
        <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    
      <a class='fr fill-darken0 round round pad1x quiet h5' href='https://github.com/nxus/storage/blob/8ebea370577a8e35ea8a8321d516d1ba6594eae1/src/index.js#L73-L76'>
      <span>src/index.js</span>
      </a>
    
  </div>
  

  <p>Register a model</p>


  <div class='pre p1 fill-light mt0'>model(model: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object">object</a>)</div>
  
  

  
  
  
  
  
  

  
    <div class='py1 quiet mt1 prose-big'>Parameters</div>
    <div class='prose'>
      
        <div class='space-bottom0'>
          <div>
            <span class='code bold'>model</span> <code class='quiet'>(<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object">object</a>)</code>
	    A Waterline-compatible model class

          </div>
          
        </div>
      
    </div>
  

  

  

  

  
    <div class='py1 quiet mt1 prose-big'>Example</div>
    
      
      <pre class='p1 overflow-auto round fill-light'>storage.model(...)</pre>
    
  

  

  

  
</section>

      </div>
    </div>
  
    <div class='border-bottom' id='Storage#getModel'>
      <div class="clearfix small pointer toggle-sibling">
        <div class="py1 contain">
            <a class='icon pin-right py1 dark-link caret-right'>▸</a>
            <span class='code strong strong truncate'>getModel(id)</span>
        </div>
      </div>
      <div class="clearfix display-none toggle-target">
        <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    
      <a class='fr fill-darken0 round round pad1x quiet h5' href='https://github.com/nxus/storage/blob/8ebea370577a8e35ea8a8321d516d1ba6594eae1/src/index.js#L85-L90'>
      <span>src/index.js</span>
      </a>
    
  </div>
  

  <p>Request a model based on its identity (name)</p>


  <div class='pre p1 fill-light mt0'>getModel(id: (<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String">string</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array">array</a>)): <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a></div>
  
  

  
  
  
  
  
  

  
    <div class='py1 quiet mt1 prose-big'>Parameters</div>
    <div class='prose'>
      
        <div class='space-bottom0'>
          <div>
            <span class='code bold'>id</span> <code class='quiet'>((<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String">string</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array">array</a>))</code>
	    The identity of a registered model, or array of identities

          </div>
          
        </div>
      
    </div>
  

  

  
    
      <div class='py1 quiet mt1 prose-big'>Returns</div>
      <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a></code>:
        The model class(es)

      
    
  

  

  
    <div class='py1 quiet mt1 prose-big'>Example</div>
    
      
      <pre class='p1 overflow-auto round fill-light'>storage.getModel(<span class="hljs-string">'user'</span>)</pre>
    
  

  

  

  
</section>

      </div>
    </div>
  
    <div class='border-bottom' id='Storage#modelDir'>
      <div class="clearfix small pointer toggle-sibling">
        <div class="py1 contain">
            <a class='icon pin-right py1 dark-link caret-right'>▸</a>
            <span class='code strong strong truncate'>modelDir(dir)</span>
        </div>
      </div>
      <div class="clearfix display-none toggle-target">
        <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    
      <a class='fr fill-darken0 round round pad1x quiet h5' href='https://github.com/nxus/storage/blob/8ebea370577a8e35ea8a8321d516d1ba6594eae1/src/index.js#L99-L121'>
      <span>src/index.js</span>
      </a>
    
  </div>
  

  <p>Register all models in a directory</p>


  <div class='pre p1 fill-light mt0'>modelDir(dir: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String">string</a>): <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a></div>
  
  

  
  
  
  
  
  

  
    <div class='py1 quiet mt1 prose-big'>Parameters</div>
    <div class='prose'>
      
        <div class='space-bottom0'>
          <div>
            <span class='code bold'>dir</span> <code class='quiet'>(<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String">string</a>)</code>
	    Directory containing model files

          </div>
          
        </div>
      
    </div>
  

  

  
    
      <div class='py1 quiet mt1 prose-big'>Returns</div>
      <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a></code>:
        Array of model identities

      
    
  

  

  
    <div class='py1 quiet mt1 prose-big'>Example</div>
    
      
      <pre class='p1 overflow-auto round fill-light'>application.get(<span class="hljs-string">'storage'</span>).model(...)</pre>
    
  

  

  

  
</section>

      </div>
    </div>
  
</div>

  

  
</section>

          
        
          
            <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    <h3 class='fl m0' id='hasmodels'>
      HasModels
    </h3>
    
    
      <a class='fr fill-darken0 round round pad1x quiet h5' href='https://github.com/nxus/storage/blob/8ebea370577a8e35ea8a8321d516d1ba6594eae1/src/HasModels.js#L21-L67'>
      <span>src/HasModels.js</span>
      </a>
    
  </div>
  

  <p>Base class for nxus modules that define or use models.
It automatically registers all model definitions contained in
the module <code>./models</code> subdirectory. It makes model definitions
available through its <a href="#HasModels#models">#HasModels#models</a> property, which you
can configure to load models defined by your module or other modules.</p>


  <div class='pre p1 fill-light mt0'>new HasModels(options: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object">Object</a>)</div>
  
  
    <p>
      Extends
      
        NxusModule
      
    </p>
  

  
  
  
  
  
  

  
    <div class='py1 quiet mt1 prose-big'>Parameters</div>
    <div class='prose'>
      
        <div class='space-bottom0'>
          <div>
            <span class='code bold'>options</span> <code class='quiet'>(<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object">Object</a>
            = <code>{}</code>)</code>
	    Configuration options.

          </div>
          
          <table class='mt1 mb2 fixed-table h5 col-12'>
            <colgroup>
              <col width='30%' />
              <col width='70%' />
            </colgroup>
            <thead>
              <tr class='bold fill-light'>
                <th>Name</th>
                <th>Description</th>
              </tr>
            </thead>
            <tbody class='mt1'>
              
                <tr>
                  <td class='break-word'><span class='code bold'>options.modelNames</span> <code class='quiet'>(<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object">Object</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array">Array</a>)</code>
                  
                    (default <code>null</code>)
                  </td>
                  <td class='break-word'><span>Model definitions to load.
If specified as an object, each object property specifies a
model 
–
 its key is a model identity (the model's

<code>identity</code>
 property), and its value is used as the model's
name in 
<a href="#hasmodelsmodels">HasModels#models</a>
. If specified as an array,
each array element specifies a model 
–
 the element
string serves as both model identity and name.
</span></td>
                </tr>
              
            </tbody>
          </table>
          
        </div>
      
    </div>
  

  

  

  

  

  

  
    <div class='py1 quiet mt1 prose-big'>Instance Members</div>
    <div class="clearfix">
  
    <div class='border-bottom' id='HasModels#models'>
      <div class="clearfix small pointer toggle-sibling">
        <div class="py1 contain">
            <a class='icon pin-right py1 dark-link caret-right'>▸</a>
            <span class='code strong strong truncate'>models</span>
        </div>
      </div>
      <div class="clearfix display-none toggle-target">
        <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    
      <a class='fr fill-darken0 round round pad1x quiet h5' href='https://github.com/nxus/storage/blob/8ebea370577a8e35ea8a8321d516d1ba6594eae1/src/HasModels.js#L64-L66'>
      <span>src/HasModels.js</span>
      </a>
    
  </div>
  

  <p>Collection of model definitions.
You can use the constructor <code>modelNames</code> option to configure which
model definitions to load. By default, the model definitions
that were registered from the module <code>./models</code> subdirectory are
also loaded into the model definitions.</p>


  <div class='pre p1 fill-light mt0'>models</div>
  
    <p>
      Type:
      <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object">Object</a>
    </p>
  
  

  
  
  
  
  
  

  

  

  

  

  

  

  

  
</section>

      </div>
    </div>
  
    <div class='border-bottom' id='HasModels#modelNames'>
      <div class="clearfix small pointer toggle-sibling">
        <div class="py1 contain">
            <a class='icon pin-right py1 dark-link caret-right'>▸</a>
            <span class='code strong strong truncate'>modelNames()</span>
        </div>
      </div>
      <div class="clearfix display-none toggle-target">
        <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    
      <a class='fr fill-darken0 round round pad1x quiet h5' href='https://github.com/nxus/storage/blob/8ebea370577a8e35ea8a8321d516d1ba6594eae1/src/HasModels.js#L64-L66'>
      <span>src/HasModels.js</span>
      </a>
    
  </div>
  

  <p>Override to define the model names to access.</p>


  <div class='pre p1 fill-light mt0'>modelNames(): (<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array">Array</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object">Object</a>)</div>
  
  

  <div>Deprecated: Use the constructor 
<code>modelNames</code>
 option to specify names of models to be made available in the 
<code>this.models</code>
 property.
</div>
  
  
  
  
  

  

  

  
    
      <div class='py1 quiet mt1 prose-big'>Returns</div>
      <code>(<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array">Array</a> | <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object">Object</a>)</code>:
        Model identities to add to 
<code>this.models</code>
, or object of {identity: name}

      
    
  

  

  
    <div class='py1 quiet mt1 prose-big'>Example</div>
    
      
      <pre class='p1 overflow-auto round fill-light'>modelNames() { 
  <span class="hljs-keyword">return</span> [<span class="hljs-string">'user'</span>]
}</pre>
    
  

  

  

  
</section>

      </div>
    </div>
  
</div>

  

  
</section>

          
        
          
            <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    <h3 class='fl m0' id='basemodel'>
      BaseModel
    </h3>
    
    
      <a class='fr fill-darken0 round round pad1x quiet h5' href='https://github.com/nxus/storage/blob/8ebea370577a8e35ea8a8321d516d1ba6594eae1/src/BaseModel.js#L40-L119'>
      <span>src/BaseModel.js</span>
      </a>
    
  </div>
  

  <p>Base class for Waterline model definitions.</p>
<p>It extends the <code>Waterline.Collection</code> to make it less awkward to use
and better adapted to the nxus environment.</p>
<p>It provides an <a href="#BaseModel.extend">extend()</a> method that is
better-behaved than the Waterline <code>extend()</code> method.</p>
<p>It emits create, update, and destroy events for model instances. The
model identity and record are passed as parameters to the handler.
You can register to be notified of all events of a specified type,
or restrict notifications to a specific model by specifying its
identity as a suffix to the event type:</p>
<ul>
<li><code>model.create</code>, <code>model.create.</code><em><code>identity</code></em> - emitted after create</li>
<li><code>model.update</code>, <code>model.update.</code><em><code>identity</code></em> - emitted after update</li>
<li><code>model.destroy</code>, <code>model.destroy.</code><em><code>identity</code></em> - emitted after destroy</li>
</ul>
<p>Use the <code>extend()</code> method to create a Waterline model based on
<code>BaseModel</code>. For example:</p>
<pre><code>  import {BaseModel} from 'nxus-storage'
  const MyModel = BaseModel.extend({
      identity: 'my-model',
      attributes: {
          name: 'string'
      }
  })
</code></pre>


  <div class='pre p1 fill-light mt0'>BaseModel</div>
  
  
    <p>
      Extends
      
        Waterline.Collection
      
    </p>
  

  
  
  
  
  
  

  

  

  

  

  

  
    <div class='py1 quiet mt1 prose-big'>Static Members</div>
    <div class="clearfix">
  
    <div class='border-bottom' id='BaseModel.connection'>
      <div class="clearfix small pointer toggle-sibling">
        <div class="py1 contain">
            <a class='icon pin-right py1 dark-link caret-right'>▸</a>
            <span class='code strong strong truncate'>connection</span>
        </div>
      </div>
      <div class="clearfix display-none toggle-target">
        <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    
      <a class='fr fill-darken0 round round pad1x quiet h5' href='https://github.com/nxus/storage/blob/8ebea370577a8e35ea8a8321d516d1ba6594eae1/src/BaseModel.js#L48-L48'>
      <span>src/BaseModel.js</span>
      </a>
    
  </div>
  

  <p>Name of the database connection for the model.
Connections are defined in the storage <a href="#configuration">configuration</a> settings.
The default connection is <code>default</code>; override to select another
configuration.</p>


  <div class='pre p1 fill-light mt0'>connection</div>
  
  

  
  
  
  
  
  

  

  

  

  

  

  

  

  
</section>

      </div>
    </div>
  
    <div class='border-bottom' id='BaseModel.findOrCreate'>
      <div class="clearfix small pointer toggle-sibling">
        <div class="py1 contain">
            <a class='icon pin-right py1 dark-link caret-right'>▸</a>
            <span class='code strong strong truncate'>findOrCreate(criteria, values)</span>
        </div>
      </div>
      <div class="clearfix display-none toggle-target">
        <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    
      <a class='fr fill-darken0 round round pad1x quiet h5' href='https://github.com/nxus/storage/blob/8ebea370577a8e35ea8a8321d516d1ba6594eae1/src/BaseModel.js#L95-L103'>
      <span>src/BaseModel.js</span>
      </a>
    
  </div>
  

  <p>Finds a record if it exists, creates it if not.</p>


  <div class='pre p1 fill-light mt0'>findOrCreate(criteria: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object">Object</a>, values: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object">Object</a>): <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object">Object</a></div>
  
  

  
  
  
  
  
  

  
    <div class='py1 quiet mt1 prose-big'>Parameters</div>
    <div class='prose'>
      
        <div class='space-bottom0'>
          <div>
            <span class='code bold'>criteria</span> <code class='quiet'>(<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object">Object</a>)</code>
	    search criteria

          </div>
          
        </div>
      
        <div class='space-bottom0'>
          <div>
            <span class='code bold'>values</span> <code class='quiet'>(<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object">Object</a>)</code>
	    attributes of the new record, if created

          </div>
          
        </div>
      
    </div>
  

  

  
    
      <div class='py1 quiet mt1 prose-big'>Returns</div>
      <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object">Object</a></code>:
        existing or newly created record

      
    
  

  

  

  

  

  
</section>

      </div>
    </div>
  
    <div class='border-bottom' id='BaseModel.createOrUpdate'>
      <div class="clearfix small pointer toggle-sibling">
        <div class="py1 contain">
            <a class='icon pin-right py1 dark-link caret-right'>▸</a>
            <span class='code strong strong truncate'>createOrUpdate(criteria, values)</span>
        </div>
      </div>
      <div class="clearfix display-none toggle-target">
        <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    
      <a class='fr fill-darken0 round round pad1x quiet h5' href='https://github.com/nxus/storage/blob/8ebea370577a8e35ea8a8321d516d1ba6594eae1/src/BaseModel.js#L110-L118'>
      <span>src/BaseModel.js</span>
      </a>
    
  </div>
  

  <p>Creates a record if it doesn't exist, updates it if it does.</p>


  <div class='pre p1 fill-light mt0'>createOrUpdate(criteria: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object">Object</a>, values: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object">Object</a>): <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object">Object</a></div>
  
  

  
  
  
  
  
  

  
    <div class='py1 quiet mt1 prose-big'>Parameters</div>
    <div class='prose'>
      
        <div class='space-bottom0'>
          <div>
            <span class='code bold'>criteria</span> <code class='quiet'>(<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object">Object</a>)</code>
	    search criteria

          </div>
          
        </div>
      
        <div class='space-bottom0'>
          <div>
            <span class='code bold'>values</span> <code class='quiet'>(<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object">Object</a>)</code>
	    record attributes

          </div>
          
        </div>
      
    </div>
  

  

  
    
      <div class='py1 quiet mt1 prose-big'>Returns</div>
      <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object">Object</a></code>:
        newly created or updated record

      
    
  

  

  

  

  

  
</section>

      </div>
    </div>
  
    <div class='border-bottom' id='BaseModel.extend'>
      <div class="clearfix small pointer toggle-sibling">
        <div class="py1 contain">
            <a class='icon pin-right py1 dark-link caret-right'>▸</a>
            <span class='code strong strong truncate'>extend(properties)</span>
        </div>
      </div>
      <div class="clearfix display-none toggle-target">
        <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    
      <a class='fr fill-darken0 round round pad1x quiet h5' href='https://github.com/nxus/storage/blob/8ebea370577a8e35ea8a8321d516d1ba6594eae1/src/BaseModel.js#L127-L138'>
      <span>src/BaseModel.js</span>
      </a>
    
  </div>
  

  <p>Extends this model definition to create a new definition.</p>


  <div class='pre p1 fill-light mt0'>extend(properties: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object">Object</a>): <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object">Object</a></div>
  
  

  
  
  
  
  
  

  
    <div class='py1 quiet mt1 prose-big'>Parameters</div>
    <div class='prose'>
      
        <div class='space-bottom0'>
          <div>
            <span class='code bold'>properties</span> <code class='quiet'>(<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object">Object</a>)</code>
	    prototype properties for the created
model; the 
<code>attributes</code>
 property, if specified, augments (rather
than replaces) the attributes of the model being extended

          </div>
          
        </div>
      
    </div>
  

  

  
    
      <div class='py1 quiet mt1 prose-big'>Returns</div>
      <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object">Object</a></code>:
        extended Waterline model definition

      
    
  

  

  

  

  

  
</section>

      </div>
    </div>
  
</div>

  

  
    <div class='py1 quiet mt1 prose-big'>Instance Members</div>
    <div class="clearfix">
  
    <div class='border-bottom' id='BaseModel#displayName'>
      <div class="clearfix small pointer toggle-sibling">
        <div class="py1 contain">
            <a class='icon pin-right py1 dark-link caret-right'>▸</a>
            <span class='code strong strong truncate'>displayName()</span>
        </div>
      </div>
      <div class="clearfix display-none toggle-target">
        <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    
      <a class='fr fill-darken0 round round pad1x quiet h5' href='https://github.com/nxus/storage/blob/8ebea370577a8e35ea8a8321d516d1ba6594eae1/src/BaseModel.js#L61-L65'>
      <span>src/BaseModel.js</span>
      </a>
    
  </div>
  

  <p>Gets a display name for the record.
Provides a consistent way to obtain a display name. The default
definition examines the record's <code>id</code>, <code>createdAt</code>, and
<code>updatedAt</code> attributes, returning the first that has a string
value. Override the default definition to provide a more useful
display name.</p>


  <div class='pre p1 fill-light mt0'>displayName(): <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String">string</a></div>
  
  

  
  
  
  
  
  

  

  

  
    
      <div class='py1 quiet mt1 prose-big'>Returns</div>
      <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String">string</a></code>:
        display name

      
    
  

  

  

  

  

  
</section>

      </div>
    </div>
  
</div>

  

  
</section>

          
        
          
            <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    <h3 class='fl m0' id='geomodel'>
      GeoModel
    </h3>
    
    
      <a class='fr fill-darken0 round round pad1x quiet h5' href='https://github.com/nxus/storage/blob/8ebea370577a8e35ea8a8321d516d1ba6594eae1/src/GeoModel.js#L192-L326'>
      <span>src/GeoModel.js</span>
      </a>
    
  </div>
  

  <p>Base class for Waterline models containing a GeoJSON geographic attribute.</p>
<p>It provides methods for performing geo queries on the GeoJSON
attribute – <code>findWithin()</code> selects records that lie within
specified coordinates, and <code>findIntersects()</code> selects records that
intersect.</p>
<p>To implement the geo queries, the GeoJSON data must be indexed. And
because the MongoDB 2dsphere index can handle only GeoJSON geometry
features, the index is applied to a derived <em>features</em> attribute that
contains just the geometry features from the primary GeoJSON
attribute.</p>
<p>The <code>GeoModel</code> provides the machinery for keeping the features
attribute synchronized with the primary GeoJSON attribute. It also
attempts to ensure the features attribute is well-formed and has a
consistent organization. For Polygon objects, it discards duplicate
points, closes open paths and ensures clockwise winding order. It
combines Geometry objects so there is at most one of each geometry
type: Polygon/MultiPolygon, Point/MultiPoint and
LineString/MultiLineString. </p>
<p>The <code>createGeoIndex()</code> method should be invoked to ensure the index
is created. Typically, you do this after the startup lifecycle phase.</p>
<p>Configuration is through these model properties:</p>
<ul>
<li><code>geometryField</code> (string) - Name of the primary GeoJSON attribute (default is <code>geo</code>).</li>
<li><code>geometryFeatureField</code> (string) - Name of the geometry features attribute (default is <code>geoFeatures</code>).
Both of these attributes must also be defined as model attributes with
type <code>json</code>.</li>
</ul>
<p>Use the <code>extend()</code> method to create a Waterline model based on
<code>GeoModel</code>. For example:</p>
<pre><code>  import {GeoModel} from 'nxus-storage'
  const MyGeo = GeoModel.extend({
      identity: 'my-geo',
      attributes: {
          ...
          location: 'json',
          locationFeatures: 'json'
      },
      geometryField: 'location',
      geometryFeaturesField: 'locationFeatures'
  })
</code></pre>


  <div class='pre p1 fill-light mt0'>GeoModel</div>
  
  
    <p>
      Extends
      
        <a href="#basemodel">BaseModel</a>
      
    </p>
  

  
  
  
  
  
  

  

  

  

  

  

  
    <div class='py1 quiet mt1 prose-big'>Static Members</div>
    <div class="clearfix">
  
    <div class='border-bottom' id='GeoModel.createGeoIndex'>
      <div class="clearfix small pointer toggle-sibling">
        <div class="py1 contain">
            <a class='icon pin-right py1 dark-link caret-right'>▸</a>
            <span class='code strong strong truncate'>createGeoIndex()</span>
        </div>
      </div>
      <div class="clearfix display-none toggle-target">
        <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    
      <a class='fr fill-darken0 round round pad1x quiet h5' href='https://github.com/nxus/storage/blob/8ebea370577a8e35ea8a8321d516d1ba6594eae1/src/GeoModel.js#L212-L220'>
      <span>src/GeoModel.js</span>
      </a>
    
  </div>
  

  <p>Ensures index is defined for geographic attribute.
(Actually, on the attribute specified by <code>geometryFeatureField</code>.)</p>


  <div class='pre p1 fill-light mt0'>createGeoIndex(): <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a></div>
  
  

  
  
  
  
  
  

  

  

  
    
      <div class='py1 quiet mt1 prose-big'>Returns</div>
      <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a></code>:
        A promise that resolves or rejects when index
creation completes. It's worthwhile attaching a 
<code>.catch()</code>

clause to this promise to log errors; index creation can fail
for a variety of reasons, including invalid data in the
geometry feature attribute.

      
    
  

  

  

  

  

  
</section>

      </div>
    </div>
  
    <div class='border-bottom' id='GeoModel.findWithin'>
      <div class="clearfix small pointer toggle-sibling">
        <div class="py1 contain">
            <a class='icon pin-right py1 dark-link caret-right'>▸</a>
            <span class='code strong strong truncate'>findWithin(coordinates)</span>
        </div>
      </div>
      <div class="clearfix display-none toggle-target">
        <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    
      <a class='fr fill-darken0 round round pad1x quiet h5' href='https://github.com/nxus/storage/blob/8ebea370577a8e35ea8a8321d516d1ba6594eae1/src/GeoModel.js#L256-L258'>
      <span>src/GeoModel.js</span>
      </a>
    
  </div>
  

  <p>Finds records within specified geographic coordinates.</p>
<p>The method goes through some odd gyrations in order to mesh the
MongoDB geographic query with Waterline query handling.</p>
<p>First, it <em>indirectly</em> returns a Waterline query, by returning a
promise that resolves to a function that evaluates to the query.
This due to the fact that the query has promise semantics.
Returning it indirectly defers evaluation, allowing you to refine
it (using the chainable methods such as .populate()<code>,</code>.where()<code>, and</code>.sort()`) before evaluating it.</p>
<p>Second, it actually evaluates the MongoDB geographic query to
produce a list of matching record ids, and the returned Waterline
query is a second query based on these ids. Again, this to allow
you to refine the query before evaluation. Be aware that this
won't scale well to huge record sets, but should work for any of
moderate size.</p>


  <div class='pre p1 fill-light mt0'>findWithin(coordinates: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object">Object</a>): <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a></div>
  
  

  
  
  
  
  
  

  
    <div class='py1 quiet mt1 prose-big'>Parameters</div>
    <div class='prose'>
      
        <div class='space-bottom0'>
          <div>
            <span class='code bold'>coordinates</span> <code class='quiet'>(<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object">Object</a>)</code>
	    A GeoJSON geometry object
specifying the geographic region to select; it must be of type

<code>Polygon</code>
 or 
<code>MultiPolygon</code>
.

          </div>
          
        </div>
      
    </div>
  

  

  
    
      <div class='py1 quiet mt1 prose-big'>Returns</div>
      <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a></code>:
        A promise that resolves to a function that
returns a Waterline query for the specified coordinates.

      
    
  

  

  
    <div class='py1 quiet mt1 prose-big'>Example</div>
    
      
      <pre class='p1 overflow-auto round fill-light'><span class="hljs-string">``</span><span class="hljs-string">`
  model.findWithin({ 'type': 'Polygon', 'coordinates': ... }).then((query) =&gt; {
    return query().where(...).populate(...)
  }).then((records) =&gt; {
    ...
  })
  `</span><span class="hljs-string">``</span></pre>
    
  

  

  

  
</section>

      </div>
    </div>
  
    <div class='border-bottom' id='GeoModel.findIntersects'>
      <div class="clearfix small pointer toggle-sibling">
        <div class="py1 contain">
            <a class='icon pin-right py1 dark-link caret-right'>▸</a>
            <span class='code strong strong truncate'>findIntersects(coordinates)</span>
        </div>
      </div>
      <div class="clearfix display-none toggle-target">
        <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    
      <a class='fr fill-darken0 round round pad1x quiet h5' href='https://github.com/nxus/storage/blob/8ebea370577a8e35ea8a8321d516d1ba6594eae1/src/GeoModel.js#L267-L269'>
      <span>src/GeoModel.js</span>
      </a>
    
  </div>
  

  <p>Finds records intersecting specified geographic coordinates.</p>


  <div class='pre p1 fill-light mt0'>findIntersects(coordinates: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object">Object</a>): <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a></div>
  
  

  
  
  
  
  
  

  
    <div class='py1 quiet mt1 prose-big'>Parameters</div>
    <div class='prose'>
      
        <div class='space-bottom0'>
          <div>
            <span class='code bold'>coordinates</span> <code class='quiet'>(<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object">Object</a>)</code>
	    A GeoJSON geometry object
specifying the geographic region to select.

          </div>
          
        </div>
      
    </div>
  

  

  
    
      <div class='py1 quiet mt1 prose-big'>Returns</div>
      <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise">Promise</a></code>:
        A promise that resolves to a function that
returns a Waterline query for the specified coordinates. See

<code>findWithin()</code>
 for further explanation.

      
    
  

  

  

  

  

  
</section>

      </div>
    </div>
  
    <div class='border-bottom' id='GeoModel.getGeometry'>
      <div class="clearfix small pointer toggle-sibling">
        <div class="py1 contain">
            <a class='icon pin-right py1 dark-link caret-right'>▸</a>
            <span class='code strong strong truncate'>getGeometry(record, types)</span>
        </div>
      </div>
      <div class="clearfix display-none toggle-target">
        <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    
      <a class='fr fill-darken0 round round pad1x quiet h5' href='https://github.com/nxus/storage/blob/8ebea370577a8e35ea8a8321d516d1ba6594eae1/src/GeoModel.js#L280-L291'>
      <span>src/GeoModel.js</span>
      </a>
    
  </div>
  

  <p>Gets GeoJSON geometry object from the GeoJSON geographic attribute.
Typical use is to extract <code>Polygon</code> geometry objects for use as
coordinates for the <code>findWithin()</code> or <code>findIntersects()</code> methods.</p>


  <div class='pre p1 fill-light mt0'>getGeometry(record: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object">Object</a>, types: ...<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String">string</a>): <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object">Object</a></div>
  
  

  
  
  
  
  
  

  
    <div class='py1 quiet mt1 prose-big'>Parameters</div>
    <div class='prose'>
      
        <div class='space-bottom0'>
          <div>
            <span class='code bold'>record</span> <code class='quiet'>(<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object">Object</a>)</code>
	    <code>GeoModel</code>
 record containing geographic attribute

          </div>
          
        </div>
      
        <div class='space-bottom0'>
          <div>
            <span class='code bold'>types</span> <code class='quiet'>(...<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/String">string</a>)</code>
	    geometry types to include (default is
all types: 
<code>Polygon</code>
, 
<code>Point</code>
 and 
<code>LineString</code>
)

          </div>
          
        </div>
      
    </div>
  

  

  
    
      <div class='py1 quiet mt1 prose-big'>Returns</div>
      <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object">Object</a></code>:
        GeoJSON geometry object; undefined if no
matching geometry objects were present

      
    
  

  

  

  

  

  
</section>

      </div>
    </div>
  
    <div class='border-bottom' id='GeoModel.getCentroid'>
      <div class="clearfix small pointer toggle-sibling">
        <div class="py1 contain">
            <a class='icon pin-right py1 dark-link caret-right'>▸</a>
            <span class='code strong strong truncate'>getCentroid(record)</span>
        </div>
      </div>
      <div class="clearfix display-none toggle-target">
        <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    
      <a class='fr fill-darken0 round round pad1x quiet h5' href='https://github.com/nxus/storage/blob/8ebea370577a8e35ea8a8321d516d1ba6594eae1/src/GeoModel.js#L298-L308'>
      <span>src/GeoModel.js</span>
      </a>
    
  </div>
  

  <p>Gets the centroid of the GeoJSON geographic attribute.</p>


  <div class='pre p1 fill-light mt0'>getCentroid(record: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object">Object</a>): <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object">Object</a></div>
  
  

  
  
  
  
  
  

  
    <div class='py1 quiet mt1 prose-big'>Parameters</div>
    <div class='prose'>
      
        <div class='space-bottom0'>
          <div>
            <span class='code bold'>record</span> <code class='quiet'>(<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object">Object</a>)</code>
	    <code>GeoModel</code>
 record containing geographic attribute

          </div>
          
        </div>
      
    </div>
  

  

  
    
      <div class='py1 quiet mt1 prose-big'>Returns</div>
      <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object">Object</a></code>:
        GeoJSON Point object; undefined if no
geometry objects were present from which to derive a centroid

      
    
  

  

  

  

  

  
</section>

      </div>
    </div>
  
</div>

  

  

  
</section>

          
        
          
            <section class='p2 mb2 clearfix bg-white minishadow'>

  
  <div class='clearfix'>
    
    <h3 class='fl m0' id='pointmodel'>
      PointModel
    </h3>
    
    
      <a class='fr fill-darken0 round round pad1x quiet h5' href='https://github.com/nxus/storage/blob/8ebea370577a8e35ea8a8321d516d1ba6594eae1/src/PointModel.js#L25-L68'>
      <span>src/PointModel.js</span>
      </a>
    
  </div>
  

  <p>Base collection for Waterline models containing a GeoJSON coordinate point attribute.</p>


  <div class='pre p1 fill-light mt0'>PointModel</div>
  
  
    <p>
      Extends
      
        <a href="#basemodel">BaseModel</a>
      
    </p>
  

  <div>Deprecated: Use 
<a href="#geomodel">GeoModel</a>
.
</div>
  
  
  
  
  

  

  

  

  

  

  

  

  
</section>

          
        
      </div>
    </div>
  </div>
  <script src='assets/anchor.js'></script>
  <script src='assets/site.js'></script>
</body>
</html>
